<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ê³ ë ¤ì˜ ì™•: ì´ìê²¸ì˜ ë‚œ</title>
    <style>
        /* [ê¸°ë³¸ ì„¤ì • & 1í˜ì´ì¦ˆ ë°°ê²½] */
        body {
            font-family: 'Nanum Myeongjo', serif;
            background: radial-gradient(circle, #34495e 0%, #1a252f 100%); 
            color: #ecf0f1;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh; margin: 0; overflow: hidden;
            user-select: none; -webkit-tap-highlight-color: transparent;
            transition: background 2s ease-in-out; 
        }

        /* [2í˜ì´ì¦ˆ ë°°ê²½] */
        body.phase-fire {
            background: radial-gradient(circle, #801d1d 0%, #1a0505 100%);
            animation: fireGlow 3s infinite alternate;
        }
        @keyframes fireGlow {
            0% { box-shadow: inset 0 0 50px rgba(255, 69, 0, 0.2); }
            100% { box-shadow: inset 0 0 150px rgba(255, 0, 0, 0.6); }
        }

        /* [ë ˆì´ì–´ ìˆœì„œ ì •ë¦¬] */
        .game-container { z-index: 1; }
        .warning-overlay { z-index: 10; }
        .intro-overlay { z-index: 9999; }
        .game-over-overlay { z-index: 10000; }
        .achieve-modal { z-index: 20000; }
        .toast { z-index: 30000; }
        .achieve-btn { z-index: 30000; }

        /* [ì¸íŠ¸ë¡œ í™”ë©´] */
        .intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: black;
            display: flex; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box;
            transition: opacity 1s; cursor: pointer;
        }
        .intro-text { 
            font-size: 22px; font-weight: bold; line-height: 1.8; margin-bottom: 50px; 
            opacity: 0; /* ì´ˆê¸°ì—” íˆ¬ëª… */
            max-width: 80%; pointer-events: none; 
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); 
        }
        
        /* ì¸íŠ¸ë¡œ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ */
        .intro-text.show { animation: fadeIn 1.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* [ê²Œì„ ì»¨í…Œì´ë„ˆ] */
        .game-container { width: 320px; text-align: center; position: relative; opacity: 0; transition: opacity 1s; }
        
        /* [ìƒë‹¨ 3ìŠ¤íƒ¯ë°”] */
        .top-bar {
            display: flex; justify-content: space-between;
            width: 240px; padding: 10px 15px;
            background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin: 0 auto 20px auto;
        }
        .stat-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; position: relative; }
        .stat-item {
            position: relative; width: 45px; height: 45px;
            background-color: rgba(0, 0, 0, 0.5); border-radius: 50%;
            border: 2px solid #bdc3c7; overflow: hidden;
        }
        .stat-fill { position: absolute; bottom: 0; left: 0; width: 100%; height: 50%; background-color: #ecf0f1; opacity: 0.8; transition: height 0.3s ease-out; z-index: 1; }
        .stat-icon { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 22px; z-index: 2; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .stat-name { font-size: 11px; font-weight: bold; color: #bdc3c7; text-shadow: 0 1px 2px black; }

        /* [í•˜ë‹¨ ê²Œì´ì§€ ë°”] */
        .bottom-stats-container { width: 290px; margin: 25px auto 0; display: flex; flex-direction: column; gap: 12px; }
        .bar-row {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(0, 0, 0, 0.5); padding: 8px 15px;
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            position: relative; 
        }
        .bar-icon { font-size: 18px; margin-right: 5px; width: 20px; text-align: center;}
        .bar-label { font-size: 12px; font-weight: bold; color: #bdc3c7; margin-right: 10px; width: 30px; text-align: left; }
        .bar-track { flex-grow: 1; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-right: 10px; }
        .bar-value-fill { height: 100%; width: 50%; background: #f1c40f; transition: width 0.3s ease-out; }
        .bar-text { font-size: 14px; font-weight: bold; width: 25px; text-align: right; }

        /* [ë¯¸ë¦¬ë³´ê¸° ì ] */
        .indicator {
            width: 8px; height: 8px; background-color: #f1c40f; 
            border-radius: 50%; position: absolute; left: 50%; transform: translateX(-50%); 
            opacity: 0; transition: opacity 0.2s; box-shadow: 0 0 5px #f1c40f, 0 0 10px #f1c40f; 
            z-index: 10; pointer-events: none;
        }
        .indicator.active { opacity: 1; }
        .top-bar .indicator { top: -8px; }
        .bar-row .indicator { left: 8px; top: 50%; transform: translateY(-50%); }

        /* [46í„´ ê¸´ê¸‰ ê²½ë³´ ì´í™íŠ¸] */
        .warning-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 60%, rgba(231, 76, 60, 0.6) 100%);
            pointer-events: none; display: none;
            animation: pulseWarning 1s infinite alternate;
        }
        @keyframes pulseWarning { from { opacity: 0.3; } to { opacity: 1; } }
        
        .warning-overlay.hint {
            background: radial-gradient(circle, transparent 50%, rgba(100, 0, 0, 0.5) 100%); 
            animation: none; 
            opacity: 1;
            display: block;
        }

        /* í™”ë©´ ì „ì²´ ë¯¸ì„¸ ì§„ë™ */
        .shake-effect {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0); }
            40%, 60% { transform: translate3d(2px, 0, 0); }
        }

        /* [ì¹´ë“œ] */
        .card-container { position: relative; width: 100%; height: 360px; perspective: 1000px; }
        .card {
            background-color: #fdfbf7; color: #2c3e50; height: 320px;
            border: 3px solid #b7950b; border-radius: 12px;
            display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4), 0 5px 15px rgba(0,0,0,0.2);
            position: absolute; width: 270px; left: 0; right: 0; margin: auto;
            cursor: grab; transform-origin: 50% 100%; transition: transform 0.1s;
            touch-action: none; -webkit-user-select: none; -webkit-touch-callout: none;
        }
        .card:active { cursor: grabbing; }
        .card h2 { font-size: 20px; font-weight: 700; line-height: 1.6; margin-bottom: 10px; word-break: keep-all; color: #1a1a1a; pointer-events: none; }
        .choice-overlay {
            position: absolute; top: 40px; left: 0; width: 100%; padding: 0 40px; box-sizing: border-box;
            text-align: center; font-size: 32px; font-weight: 900; color: #e74c3c; opacity: 0; pointer-events: none;
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
        }

        /* [ê²Œì„ ì˜¤ë²„ & ì‚¬ë£Œ ì—”ë”© í™”ë©´] */
        .game-over-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.95); flex-direction: column;
            align-items: center; justify-content: center; color: white; text-align: center;
        }

        /* ì‚¬ë£Œ ì¢…ì´ ìŠ¤íƒ€ì¼ (ê³ í’ìŠ¤ëŸ¬ìš´ ë‘ë£¨ë§ˆë¦¬) */
        .history-paper {
            width: 85%; max-width: 400px;
            background: linear-gradient(to bottom, #f4e4bc, #e8d5a7);
            color: #3e2723;
            padding: 30px; border-radius: 4px;
            border-top: 15px solid #4a3121;
            border-bottom: 15px solid #4a3121;
            border-left: 1px solid #c0a080;
            border-right: 1px solid #c0a080;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            text-align: left; position: relative;
            max-height: 80vh; overflow-y: auto;
            clip-path: inset(0 0 100% 0);
            opacity: 1;
        }
        .history-paper.open-effect {
            animation: scrollUnroll 2.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }
        @keyframes scrollUnroll {
            0% { clip-path: inset(0 0 100% 0); }
            100% { clip-path: inset(0 0 0 0); }
        }

        .history-title {
            text-align: center; font-family: 'Nanum Myeongjo', serif;
            border-bottom: 2px solid #4a3121; padding-bottom: 10px; margin-bottom: 20px;
            font-size: 24px; font-weight: bold; color: #2d1e17; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .history-label { font-weight: bold; color: #795548; margin-right: 5px; }
        .history-text { color: #4e342e; }
        .history-list li { margin-bottom: 3px; color: #5d4037; font-size: 14px; }

        /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ */
        .restart-btn {
            display: block; width: 100%; margin-top: 25px;
            padding: 15px; background: #4a3121; color: #f4e4bc;
            border: 3px solid #2d1e17; border-radius: 8px; font-weight: bold; font-size: 18px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: all 0.2s; font-family: 'Nanum Myeongjo', serif;
        }
        .restart-btn:hover { background: #5d4037; transform: translateY(-2px); }
        .restart-btn:active { transform: translateY(1px); box-shadow: 0 2px 5px rgba(0,0,0,0.3); }

        /* [ì—…ì  UI] */
        .achieve-btn {
            position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.5); border: 1px solid white;
            color: white; padding: 5px 10px; border-radius: 15px; font-size: 20px; cursor: pointer;
        }
        .achieve-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); align-items: center; justify-content: center;
        }
        .achieve-box {
            width: 300px; height: 500px; background: #2c3e50; border: 2px solid #f1c40f;
            border-radius: 10px; padding: 20px; overflow-y: auto; color: white; position: relative;
        }
        .achieve-item {
            display: flex; align-items: center; gap: 10px; padding: 10px; margin-bottom: 10px;
            background: rgba(255,255,255,0.1); border-radius: 5px; opacity: 0.5; filter: grayscale(100%);
        }
        .achieve-item.unlocked { opacity: 1; filter: grayscale(0%); background: rgba(241, 196, 15, 0.2); border: 1px solid #f1c40f; }
        .achieve-icon { font-size: 24px; }
        .achieve-info h3 { margin: 0; font-size: 14px; color: #f1c40f; }
        .achieve-info p { margin: 3px 0 0 0; font-size: 11px; color: #bdc3c7; }
        .close-achieve { position: absolute; top: 10px; right: 15px; font-size: 20px; cursor: pointer; color: white; }

        /* [ì—…ì  ì•Œë¦¼ í† ìŠ¤íŠ¸] */
        .toast {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: rgba(241, 196, 15, 0.9); color: #2c3e50; padding: 10px 20px;
            border-radius: 20px; font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); transition: top 0.5s; width: 80%; text-align: center;
        }
        .toast.show { top: 20px; }
    </style>
</head>
<body>

    <button class="achieve-btn" onclick="openAchieve()">ğŸ†</button>
    <div class="toast" id="toast">ì—…ì  ë‹¬ì„±!</div>
    <div id="achieve-modal" class="achieve-modal">
        <div class="achieve-box">
            <div class="close-achieve" onclick="closeAchieve()">âœ–</div>
            <h2 style="text-align:center; margin-top:0; border-bottom:1px solid #7f8c8d; padding-bottom:10px;">ì™•ì˜ ë°œìì·¨</h2>
            <div id="achieve-list"></div>
        </div>
    </div>

    <div id="intro-screen" class="intro-overlay" onclick="nextIntro()">
        <div id="intro-text" class="intro-text"></div>
    </div>
    
    <div id="warning-overlay" class="warning-overlay"></div>
    
    <div id="game-container" class="game-container">
        <div class="top-bar">
            <div class="stat-wrapper">
                <div class="indicator" id="ind-0"></div>
                <div class="stat-item"><div class="stat-icon">ğŸ‘‘</div><div class="stat-fill" id="fill-royal"></div></div>
                <div class="stat-name" id="label-royal">ì™•ê¶Œ</div> </div>
            <div class="stat-wrapper">
                <div class="indicator" id="ind-1"></div>
                <div class="stat-item"><div class="stat-icon">ğŸ</div><div class="stat-fill" id="fill-kin"></div></div>
                <div class="stat-name" id="label-kin">ì™¸ì²™</div> </div>
            <div class="stat-wrapper">
                <div class="indicator" id="ind-2"></div>
                <div class="stat-item"><div class="stat-icon">âš”ï¸</div><div class="stat-fill" id="fill-military"></div></div>
                <div class="stat-name" id="label-military">êµ°ì‚¬</div> </div>
        </div>

        <div class="card-container">
            <div class="card" id="game-card">
                <div class="choice-overlay" id="choice-overlay">ì„ íƒ</div>
                <h2 id="question-text">ë¡œë”© ì¤‘...</h2>
                <p id="year-text" style="font-size: 12px; color: #7f8c8d; margin-top: 20px;">(ì¸ì¢… ì¬ìœ„ 1ë…„)</p>
                <div style="position:absolute; bottom:15px; opacity:0.3; font-size:14px; color:#bdc3c7;">â–¼ ì¹´ë“œë¥¼ ë“œë˜ê·¸</div>
            </div>
        </div>

        <div class="bottom-stats-container">
            <div class="bar-row">
                <div class="indicator" id="ind-3"></div>
                <div class="bar-icon">ğŸ’°</div>
                <div class="bar-label">êµ­ê³ </div>
                <div class="bar-track"><div class="bar-value-fill" id="fill-money"></div></div>
                <div class="bar-text" id="text-money">50</div>
            </div>
            <div class="bar-row">
                <div class="indicator" id="ind-4"></div>
                <div class="bar-icon">ğŸŒ¾</div>
                <div class="bar-label">ë¯¼ì‹¬</div>
                <div class="bar-track"><div class="bar-value-fill" id="fill-public"></div></div>
                <div class="bar-text" id="text-public">50</div>
            </div>
        </div>
    </div>

    <div id="game-over-screen" class="game-over-overlay">
        <div class="history-paper">
            <h2 class="history-title">ê³ ë ¤ì‚¬(é«˜éº—å²) - ì¸ì¢… ì„¸ê°€</h2>
            <div class="history-content" id="history-content">
            </div>
            <button class="restart-btn" onclick="resetGame()">ì—­ì‚¬ ë‹¤ì‹œ ì“°ê¸°</button>
        </div>
    </div>

    <script>
    // --------------------------------------------------------------------------------
    // [ì‹œìŠ¤í…œ] ì—…ì  ë°ì´í„° ë° í•¨ìˆ˜ (LocalStorage ì‚¬ìš©)
    // --------------------------------------------------------------------------------
    const achievements = [
        { id: "win_balance", icon: "ğŸ‘‘", title: "ì§„ì •í•œ ì™•", desc: "ì´ìê²¸ì„ ëª°ì•„ë‚´ê³  ê³ ë ¤ì˜ ê· í˜•ì„ ë˜ì°¾ë‹¤." },
        { id: "die_poison", icon: "ğŸ’€", title: "ë¹„ìš´ì˜ ë¯¸ì‹ê°€", desc: "ìˆ˜ìƒí•œ ë–¡ì„ ë¨¹ê³  ìƒì„ ë§ˆê°í•˜ë‹¤." },
        { id: "die_royal", icon: "ğŸ¥€", title: "ìŠí˜€ì§„ ì™•", desc: "ì™•ê¶Œì´ ë°”ë‹¥ë‚˜ íìœ„ë˜ë‹¤." },
        { id: "die_kin", icon: "ğŸ­", title: "ê¼­ë‘ê°ì‹œ", desc: "ì™¸ì²™ì˜ í˜ì´ ë„ˆë¬´ ê°•í•´ì ¸ ê¼­ë‘ê°ì‹œê°€ ë˜ë‹¤." },
        { id: "die_military", icon: "âš”ï¸", title: "êµ°ë¶€ì˜ í¬ìƒì–‘", desc: "êµ°ë¶€ì˜ í˜ì´ ê°•í•´ì§€ê±°ë‚˜, ë°˜ë€ìœ¼ë¡œ ì‚¬ë§í•˜ë‹¤." },
        { id: "die_money", icon: "ğŸ’¸", title: "íŒŒì‚° ì‹ ì²­", desc: "êµ­ê³  íƒ•ì§„ìœ¼ë¡œ ê³ ë ¤ê°€ ë§í•˜ë‹¤." },
        { id: "die_public", icon: "ğŸ”¥", title: "ì„±ë‚œ ë¯¼ì‹¬", desc: "ë¯¼ë€ì´ ì¼ì–´ë‚˜ ê¶ê¶ì´ ë¶ˆíƒ€ë‹¤." },
        { id: "turn_50", icon: "â³", title: "ì ˆë°˜ì˜ ì„±ê³µ", desc: "50í„´(ì•½ 4ë…„)ì„ ë²„í‹°ë‹¤." },
        { id: "turn_100", icon: "ğŸ“œ", title: "ì¥ìˆ˜ì™•", desc: "100í„´ ì´ìƒ ì¥ê¸° ì§‘ê¶Œí•˜ë‹¤." },
	{ id: "max_money", icon: "ğŸ’°", title: "ë¶€êµ­", desc: "êµ­ê³ ê°€ ê°€ë“ ì°¨ ë„˜ì³ ë¶€ìœ í•œ ë‚˜ë¼ë¥¼ ì´ë£¨ë‹¤." },
        { id: "max_public", icon: "ğŸ™", title: "ì„±êµ°", desc: "ë¯¼ì‹¬ì´ í•˜ëŠ˜ì„ ì°Œë¥´ë‹ˆ ì‹¤ë¡œ ë§Œë°±ì„±ì˜ ì–´ë²„ì´ë¼ í• ë§Œí•˜ë‹¤." }
    ];

    function getUnlockedData() {
        return JSON.parse(localStorage.getItem("reigns_achievements")) || [];
    }

    function unlockAchievement(id) {
        let unlocked = getUnlockedData();
        if (!unlocked.includes(id)) {
            unlocked.push(id);
            localStorage.setItem("reigns_achievements", JSON.stringify(unlocked));
            const item = achievements.find(a => a.id === id);
            if(item) showToast(`ğŸ† ì—…ì  ë‹¬ì„±: ${item.title}`);
        }
    }

    function showToast(msg) {
        const t = document.getElementById("toast");
        t.innerText = msg; t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 3000);
    }

    function openAchieve() {
        const modal = document.getElementById("achieve-modal");
        const list = document.getElementById("achieve-list");
        const unlocked = getUnlockedData();
        list.innerHTML = "";
        achievements.forEach(a => {
            const isUnlocked = unlocked.includes(a.id);
            const div = document.createElement("div");
            div.className = `achieve-item ${isUnlocked ? "unlocked" : ""}`;
            div.innerHTML = `<div class="achieve-icon">${a.icon}</div><div class="achieve-info"><h3>${a.title} ${isUnlocked ? "âœ…" : "ğŸ”’"}</h3><p>${isUnlocked ? a.desc : "???"}</p></div>`;
            list.appendChild(div);
        });
        modal.style.display = "flex";
    }

    function closeAchieve() { document.getElementById("achieve-modal").style.display = "none"; }

    // --------------------------------------------------------------------------------
    // [ê²Œì„ ë¡œì§]
    // --------------------------------------------------------------------------------
    const introLines = [
        "ê³ ë ¤ ì˜ˆì¢… 17ë…„â€¦",
        "ë”¸ì´ ì™•ë¹„ë¡œ ì±…ë´‰ëœ ì™¸ì²™ ì„¸ë ¥ â€˜ì´ìê²¸â€™ì´<br>ì ì  ì„¸ë ¥ì„ ë„“íˆê³  ìˆê³ ,",
        "ë¶ë°©ì—ì„œëŠ” ë¬´ì‹  â€˜ì²™ì¤€ê²½â€™ì´<br>ì—¬ì§„ì •ë²Œì—ì„œ í° í™œì•½ì„ í¼ì³¤ìŠµë‹ˆë‹¤.",
        "ì™•ê¶Œê³¼ ì™¸ì²™, ë¶€êµ­ê°•ë³‘ì´ ë°”ëŒ ì•ì˜ ì´›ë¶ˆì²˜ëŸ¼ ìœ„íƒœë¡­ê²Œ ë†“ì—¬ìˆìœ¼ë‹ˆ,",
        "ê³§ ë‹¹ì‹ ì´ ì™•ìœ„ì— ì˜¤ë¥´ëŠ” ìˆœê°„, ì´ ëª¨ë“  í˜ì˜ <strong>ê· í˜•</strong>ì€ ë‹¹ì‹ ì„ ì‹œí—˜í•  ê²ƒì…ë‹ˆë‹¤."
    ];

    let introIndex = 0;
    
    // [ì¤‘ìš”] ì¸íŠ¸ë¡œ í…ìŠ¤íŠ¸ í‘œì‹œ í•¨ìˆ˜
    function showIntroText() {
        const txt = document.getElementById("intro-text");
        if(introIndex < introLines.length) {
            txt.innerHTML = introLines[introIndex]; 
            // ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘ì„ ìœ„í•œ ê¼¼ìˆ˜
            txt.classList.remove("show");
            void txt.offsetWidth; // ë¦¬í”Œë¡œìš° ê°•ì œ
            txt.classList.add("show");
        } else {
            const sc = document.getElementById("intro-screen"); 
            sc.style.opacity=0; 
            sc.style.pointerEvents="none";
            setTimeout(()=>{ 
                sc.style.display="none"; 
                document.getElementById("game-container").style.opacity=1; 
                initSwipe(); 
            }, 1000);
        }
    }

    function nextIntro() {
        introIndex++;
        showIntroText();
    }

    // ê²Œì„ ë³€ìˆ˜
    let stats = { royal: 50, kin: 50, military: 50, money: 50, public: 50 };
    let turn = 1; 
    let currentCard = {}; 
    let nextEventCard = null;
    let isPhase2 = false;
    let phase2StartTurn = 0;

    // [ë°ì´í„° 1] ì—°ê³„ ì´ë²¤íŠ¸
    const event_fire_loot = {
        text: "â€œë¶ˆì´ ì„œì ê³¼ ë³´ë¬¼ì´ ê°€ë“í•œ ì „ê°ìœ¼ë¡œ ë²ˆì§€ê³  ìˆìŠµë‹ˆë‹¤!â€", leftBtn: "ì™•ì‹¤ ì„œì ì„ ì˜®ê²¨ë¼", rightBtn: "ë³´ë¬¼ì„ ì±™ê²¨ë¼", leftEffect: [5, 0, 0, -10, 0], rightEffect: [-10, 0, 0, 20, -10], requirePhase2: true };
    const event_arson = { text: "â€œì²™ì¤€ê²½ì´ ê²°êµ­ ê¶ì— ë¶ˆì„ ì§ˆë €ìŠµë‹ˆë‹¤! ì—°ê²½ê¶ì´ íƒ€ê³  ìˆìŠµë‹ˆë‹¤!â€", leftBtn: "ë¶ˆë¶€í„° êº¼ë¼", rightBtn: "ë„ë§ì¹˜ì", leftEffect: [0, 0, 0, -10, 5], rightEffect: [-20, 0, 0, 0, -20], leftNext: event_fire_loot, rightNext: event_fire_loot, requirePhase2: true };
    const event_seungpyeong_gate = { text: "â€œë°˜ë€êµ°ì´ ìŠ¹í‰ë¬¸(æ˜‡å¹³é–€) ì•ê¹Œì§€ ë“¤ì´ë‹¥ì³¤ìŠµë‹ˆë‹¤! ì²™ì¤€ê²½ì´ ë¬¸ì„ ë¶€ìˆ˜ë ¤ í•©ë‹ˆë‹¤!â€", leftBtn: "í™œì„ ì˜ì•„ ë§ì„œë¼!", rightBtn: "ì¼ë‹¨ ëŒ€í™”ë¡œ ì‹œê°„ì„ ëŒì–´ë¼",  leftEffect: [10, -20, -10, 0, 0], rightEffect: [-10, 0, 0, 0, 0], leftNext: event_arson, rightNext: event_arson, requirePhase2: true };
    const event_cheok_rage = {text: "â€œì²™ì¤€ê²½ì˜ ë™ìƒê³¼ ì•„ë“¤ì´ ìš°ë¦¬ êµ°ì‚¬ì—ê²Œ ì£½ì—ˆìŠµë‹ˆë‹¤! ì²™ì¤€ê²½ì´ ë¶„ë…¸í•˜ì—¬ ë‹¬ë ¤ì˜µë‹ˆë‹¤!â€", leftBtn: "ì„±ë¬¸ì„ ì ê¶ˆë¼!", rightBtn: "ì˜¤í•´ì˜€ë‹¤ê³  ì „í•´ë¼", leftEffect: [0, 0, -10, 0, -10], rightEffect: [-10, 0, 0, 0, 0], leftNext: event_seungpyeong_gate, rightNext: event_seungpyeong_gate,  requirePhase2: true };

    // [ë°ì´í„° 2] ìŠ¤í† ë¦¬ ë±
    const storyDeck = [
        { id: 1, text: "â€œì „í•˜ì˜ ì¦‰ìœ„ì— ì´ìê²¸ ëŒ€ê°ì´ ì†ì„ ì“´ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.â€", leftBtn: "ê°ì‚¬ë¥¼ í‘œí•˜ë¼", rightBtn: "ê·¸ë˜ì„œ ì–´ì©Œë¼ê³ ?", leftEffect: [-10, 10, 0, 0, 0], rightEffect: [10, -10, 0, 0, 0], downBtn: "ì¹¨ë¬µí•œë‹¤", downEffect: [0, 0, 0, 0, 0] },
        { id: 45, text: "â€œì˜í†µì‚¬ ë¶ìª½ì—ì„œ ê¹Œë§ˆê·€ ë–¼ê°€ ì‹œë„ëŸ½ê²Œ ìš¸ë©° ì„œë¡œ ì‹¸ìš°ê³  ìˆìŠµë‹ˆë‹¤. í‰ì¡°ê°€ ë¶„ëª…í•©ë‹ˆë‹¤.â€", leftBtn: "ì œì‚¬ë¥¼ ì§€ë‚´ ì•¡ìš´ì„ ë§‰ì•„ë¼", rightBtn: "ë¯¸ë¬¼ë“¤ì˜ ë‹¤íˆ¼ì¼ ë¿ì´ë‹¤", leftEffect: [0, 0, 0, -10, 10], rightEffect: [5, 0, 0, 0, -10] }, 
        { id: 46, text: "â€œíí•˜, ë¶ˆë§Œì„ í’ˆì€ ë¬´ì‹ ë“¤ì´ ì´ìê²¸ì„ ì¹˜ìê³  ì œì•ˆí•©ë‹ˆë‹¤. ì´ìê²¸ê³¼ ì²™ì¤€ê²½ì„ ì œê±°í•  ìˆ˜ ìˆëŠ” ê¸°íšŒì¼ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤...â€", leftBtn: "ì§€ê¸ˆì´ ê¸°íšŒë‹¤!", rightBtn: "ê·¸ë“¤ì—ê²Œ ë¹Œë¯¸ë¥¼ ì¤„ ë¿ì´ë‹¤", leftEffect: [10, -30, 10, 0, 0], leftNext: event_cheok_rage, rightEffect: [-5, 5, 0, 0, 0] },
        { id: 51, text: "â€œíí•˜! í˜ˆê¸° ì™•ì„±í•œ ì¸¡ê·¼ë“¤ì´ ì°¸ì§€ ëª»í•˜ê³  ë…ë‹¨ì ìœ¼ë¡œ ì´ìê²¸ì˜ ì§‘ì„ ê³µê²©í–ˆìŠµë‹ˆë‹¤!â€", leftBtn: "ì´ì™• ì´ë ‡ê²Œ ëœ ê±° ì³ë¼!", rightBtn: "ì–´ë¦¬ì„ì€ ë†ˆë“¤...", leftEffect: [0, 0, 0, 0, 0], leftNext: event_cheok_rage, rightEffect: [0, 0, 0, 0, 0], rightNext: event_cheok_rage, downBtn: "ì¹¨ë¬µí•œë‹¤", downEffect: [0, 0, 0, 0, 0], downNext: event_cheok_rage }
    ];

    // [ë°ì´í„° 3] ëœë¤ ë± (ìµœì¢… í†µí•©ë³¸)
    const randomDeck = [
        { onlyPhase1: true, text: "â€œì „í•˜, ì´ìê²¸ ëŒ€ê°ê»˜ì„œ ì…‹ì§¸ ë”¸ì„ ì „í•˜ì˜ ë¹„ë¡œ ë§ì´í•˜ë¼ê³  í•˜ì‹­ë‹ˆë‹¤.â€", leftBtn: "ì´ëª¨ì™€ ê²°í˜¼ì´ë¼ë‹ˆ!", rightBtn: "ë°›ì•„ë“¤ì—¬ë¼", leftEffect: [5, -15, 0, 0, 5], rightEffect: [-10, 15, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œëŒ€ê°ì˜ ì‚¬ì´Œì˜ íŒ”ì´Œì„ ì¥êµ°ìœ¼ë¡œ ì„ëª…í•˜ë¼ëŠ” ìƒì†Œê°€ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤.â€", leftBtn: "ì‹œí‚¤ëŠ” ëŒ€ë¡œ í•´", rightBtn: "ëŠ¥ë ¥ì´ ìš°ì„ ì´ë‹¤", leftEffect: [-5, 10, -5, 0, 0], rightEffect: [5, -10, 5, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ ëŒ€ê°ì˜ ìƒì‹ ì…ë‹ˆë‹¤. ì„ ë¬¼ì„ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "í™”ë ¤í•˜ê²Œ ë³´ë‚´ë¼!", rightBtn: "ë§ˆìŒë§Œ ì „í•´ë¼", leftEffect: [0, 10, 0, -15, 0], rightEffect: [0, -5, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì‹œì¤‘ì— 'ì‹­ì(åå…«å­: ì´ì”¨)ê°€ ì™•ì´ ëœë‹¤'ëŠ” ì†Œë¬¸ì´ ëŒê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "í—›ì†Œë¬¸ì´ë‹¤!", rightBtn: "í¥ë¯¸ë¡­êµ°...", leftEffect: [-5, 5, 0, 0, 0], rightEffect: [5, -10, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ ëŒ€ê°ì´ ì „í•˜ê»˜ ë–¡ì„ ë³´ëƒˆìŠµë‹ˆë‹¤. ë¬´ì–¸ê°€ ìˆ˜ìƒí•©ë‹ˆë‹¤.â€", leftBtn: "ì¥ì¸ì˜ ì •ì„±ì¸ë°...", rightBtn: "ìƒˆì—ê²Œ ë˜ì ¸ë¼", leftEffect: [0, 0, 0, 0, 0], isPoison: true, rightEffect: [5, -10, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì™•ì‹¤ì˜ ì¬ì •ê³¼ ì´ìê²¸ ê°€ë¬¸ì˜ ì¬ì •ì´ ì„ì—¬ êµ­ê³  íŒŒì•…ì´ ì–´ë µìŠµë‹ˆë‹¤.â€", leftBtn: "ë¶„ë¦¬ ê°œí˜ì„ ì¶”ì§„í•˜ë¼", rightBtn: "ì¥ì¸ì´ ì•Œì•„ì„œ í•˜ê² ì§€", leftEffect: [5, -10, 0, 5, 0], rightEffect: [-5, 10, 0, -5, 0] },
        { onlyPhase1: true, text: "â€œì‹ í•˜ë“¤ì´ ì¤‘ì•™êµ°ì˜ ê·œëª¨ë¥¼ ë‘ ë°°ë¡œ ëŠ˜ë¦¬ìê³  ì œì•ˆí•©ë‹ˆë‹¤.â€", leftBtn: "ë¹„ë°€ë¦¬ì— ì§„í–‰í•œë‹¤", rightBtn: "ëˆì´ ë¬¸ì œë‹¤", leftEffect: [0, -5, 10, -10, 0], rightEffect: [0, 0, -5, 5, 0] },
        { onlyPhase1: true, text: "â€œì˜¬í•´ëŠ” í’ë…„ì…ë‹ˆë‹¤. ë°±ì„±ë“¤ì´ ìˆ˜í™•í•œ ê³¡ì‹ ë•ë¶„ì— êµ­ê³ ê°€ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.â€", leftBtn: "ì„¸ê¸ˆì„ ë‚®ì¶°ë¼", rightBtn: "ì „ë¶€ ì§ì˜ ê²ƒì´ë‹¤!", leftEffect: [0, 0, 0, -5, 15], rightEffect: [0, 0, 0, 15, -15] },
        { onlyPhase1: true, text: "â€œì†¡ë‚˜ë¼ì˜ ì‚¬ì‹ ì´ ê¸ˆë‚˜ë¼ë¥¼ ê²¬ì œí•˜ìë©° ì„ ë¬¼ì„ ê°€ì§€ê³  ì™”ìŠµë‹ˆë‹¤.â€", leftBtn: "êµ­ê³ ì— ì±„ì›Œ ë„£ì–´", rightBtn: "ê¸ˆì„ í™”ë‚˜ê²Œ í•´ì„  ì•ˆëœë‹¤â€¦", leftEffect: [0, 0, 5, 10, 0], rightEffect: [0, 0, -5, 0, 0] },
        { onlyPhase1: true, text: "â€œë¶ë°©ì˜ ì¥êµ° í•œ ëª…ì´ ì€í‡´ í›„ ê¶ê¶ í˜¸ìœ„ì§ì„ ìì²˜í–ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì¦‰ì‹œ ì„ëª…í•œë‹¤", rightBtn: "ë…¸ê³ ë¥¼ ì¹˜í•˜í•˜ê³  ëŒë ¤ë³´ë‚¸ë‹¤", leftEffect: [5, -5, 5, -5, 0], rightEffect: [-5, 0, -5, 0, 0] },
        { onlyPhase1: true, text: "â€œê¶ê¶ ë°– ë°±ì„±ë“¤ ì‚¬ì´ì—ì„œ ì „ì—¼ë³‘ì´ ì°½ê¶í•˜ê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ê²©ë¦¬ì‹œí‚¤ê³  ë°©ì¹˜í•˜ë¼", rightBtn: "ì•½ì¬ë¥¼ ê³µê¸‰í•˜ë¼", leftEffect: [0, 0, 0, 5, -15], rightEffect: [5, 0, 0, -10, 10] },
        { onlyPhase1: true, text: "â€œë°¤ì‚¬ì´ ê¶ê¶ì— ë²¼ë½ì´ ë–¨ì–´ì ¸ í‰í‰í•œ ì†Œë¬¸ì´ ëŒê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ê¶ê¶ì„ ìˆ˜ë¦¬í•˜ë¼", rightBtn: "ìš´ëª…ì´ë‹¤", leftEffect: [0, 0, 0, -10, 5], rightEffect: [-5, 0, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œì˜¤ë˜ëœ ê±´ë¬¼ ì§€ë¶•ì´ ë¬´ë„ˆì¡ŒìŠµë‹ˆë‹¤. ì•ˆì „ì„ ìœ„í•´ì„œëŠ” ìˆ˜ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.â€", leftBtn: "êµ­ê³ ë¥¼ í„¸ì–´ ìˆ˜ë¦¬í•˜ë¼", rightBtn: "ì¥ì¸ì–´ë¥¸, ë¶€íƒë“œë¦½ë‹ˆë‹¤", leftEffect: [5, 0, 0, -10, 0], rightEffect: [-5, 10, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œë‚¨ìª½ í•´ì•ˆê°€ì— í•´ì ì´ ìì£¼ ì¶œëª°í•˜ê³  ìˆë‹¤ëŠ” ë³´ê³ ê°€ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤.â€", leftBtn: "êµ°ì‚¬ë¥¼ ë³´ë‚´ í† ë²Œí•˜ë¼", rightBtn: "ì§€ë°©ì— ë§¡ê¸´ë‹¤", leftEffect: [0, 0, -5, -5, 5], rightEffect: [0, 0, 0, 5, -10] },
        { onlyPhase1: true, text: "â€œí™˜ê´€ í•œ ëª…ì´ ì´ìê²¸ê³¼ ì²™ì¤€ê²½ì´ ì£¼ê³  ë°›ì€ ë¹„ë°€ ì„œì°°ì„ ì…ìˆ˜í•´ì™”ìŠµë‹ˆë‹¤. ì—´ì–´ë³´ì‹œê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "ì¦‰ì‹œ ì—´ì–´ ë³¸ë‹¤", rightBtn: "íƒœì›Œë²„ë ¤ë¼", leftEffect: [10, -10, -5, 0, 0], rightEffect: [-5, 5, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ íŒŒë²Œê³¼ ì™¸ì²™ë“¤ì´ ì™•ì—ê²Œ ì ˆí•  ë•Œ í—ˆë¦¬ë§Œ êµ½íˆëŠ” ê²½ìš°ê°€ ëŠ˜ê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì˜ˆë²•ì„ ë°”ë¡œì¡ì•„ë¼", rightBtn: "ì‚¬ì†Œí•œ ì¼ì´ë‹¤", leftEffect: [10, -10, 0, 0, 5], rightEffect: [-10, 10, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œë¬¸ì‹ ë“¤ì´ ëª¨ë‘ ì´ìê²¸ì„ ë‘ë ¤ì›Œí•´ ê·¸ ëˆ„êµ¬ë„ ë¹„íŒí•˜ëŠ” ì´ê°€ ì—†ìŠµë‹ˆë‹¤.â€", leftBtn: "ë…ë ¤í•œë‹¤", rightBtn: "ë¬´ì‹ ë“¤ì—ê²Œ ì˜ì§€í•œë‹¤", leftEffect: [5, -5, 0, 0, 0], rightEffect: [-5, -5, 10, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ì „ì— ì‚¬ë©´ë°›ì€ ì£„ì¸ì„ ì´ìê²¸ì´ ë‹¤ì‹œ ì²´í¬í•˜ì—¬ ì²˜í˜•í–ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ê¾¸ì§–ëŠ”ë‹¤", rightBtn: "ì‚¬ë©´ì„ ì·¨ì†Œí•œë‹¤", leftEffect: [10, -10, 0, 0, 0], rightEffect: [-10, 5, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œìŠ¹ë ¤ë“¤ì´ ëŒ€ê·œëª¨ ë¶ˆêµ í–‰ì‚¬ë¥¼ ì—´ê¸° ìœ„í•œ ì§€ì›ì„ ìš”ì²­í•©ë‹ˆë‹¤.â€", leftBtn: "ì§€ì›í•œë‹¤", rightBtn: "ì•Œì•„ì„œ í•´ë¼", leftEffect: [0, 0, 0, -10, 5], rightEffect: [0, 0, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œíƒë¼êµ°(ì œì£¼)ì—ì„œ íŠ¹ì‚°ë¬¼ì„ ê°€ì§€ê³  ì™”ìŠµë‹ˆë‹¤.â€", leftBtn: "í›„í•œ ë³´ìƒì„ ë‚´ë¦°ë‹¤", rightBtn: "ë” ê°€ì ¸ì™€!", leftEffect: [0, 0, 0, -5, 5], rightEffect: [0, 0, 0, 10, -10] },
        { onlyPhase1: true, text: "â€œì™•ì‹¤ì˜ ì •í†µì„±ì„ ìœ„í•´ ì—­ì‚¬ì„œë¥¼ ìƒˆë¡œ í¸ì°¬í•˜ìëŠ” ê±´ì˜ê°€ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤.â€", leftBtn: "í•™ìë“¤ì—ê²Œ ëª…ë ¹í•œë‹¤", rightBtn: "ì‹œê¸‰í•œ ì¼ì´ ì•„ë‹ˆë‹¤", leftEffect: [5, -5, 0, -5, 0], rightEffect: [-5, 0, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œê´€ë¦¬ ë¶€ì‹¤ë¡œ ì§€ë°© ì„¸ê¸ˆ ì§•ìˆ˜ê°€ ì›í™œí•˜ê²Œ ì´ë£¨ì–´ì§€ì§€ ì•Šê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "êµ°ì‚¬ë¥¼ íŒŒê²¬í•˜ë¼", rightBtn: "ì‚¬ì •ì„ ë´ì£¼ì", leftEffect: [0, 0, -5, 10, -10], rightEffect: [0, 0, 0, -5, 5] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ì˜ ì¢…ë“¤ì´ ë°±ì„±ë“¤ì˜ ë•…ì„ ëºì–´ ìˆ˜ë ˆì— ì‹£ê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì–´ì©” ìˆ˜ ì—†ë‹¤...", rightBtn: "ìˆ˜ë ˆë¥¼ ì—ì–´ë¼!", leftEffect: [-5, 5, 0, 0, -10], rightEffect: [5, -10, 0, 0, 10] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ì´ ì§‘ì— 'ìˆ­ë•ë¶€'ë¼ëŠ” ê´€ì²­ì„ ì„¸ìš°ê³  ë…ìì ìœ¼ë¡œ ì •ì¹˜ë¥¼ í•˜ë ¤ í•©ë‹ˆë‹¤.â€", leftBtn: "ìˆ˜ê³ ë¥¼ ëœì–´ì£¼ë‹ˆ...", rightBtn: "ì™•ì´ ë‘˜ì´ëƒ?", leftEffect: [-10, 15, 0, 0, 0], rightEffect: [10, -15, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ì´ ëª°ë˜ ì‚¬ë³‘ì„ ê¸°ë¥´ê³  ë¬´ê¸°ë¥¼ ì‚¬ë“¤ì´ê³  ìˆë‹¤ëŠ” ì²©ë³´ì…ë‹ˆë‹¤.â€", leftBtn: "ë‚˜ë¼ë¥¼ ìœ„í•´ì„œê² ì§€", rightBtn: "ìš°ë¦¬ë„ ëª¨ìœ¼ì", leftEffect: [-5, 5, -5, 0, 0], rightEffect: [5, -10, 10, -10, 0] },
        { onlyPhase1: true, text: "â€œë§¤í˜•(ì´ìê²¸ì˜ ì•„ë“¤)ì´ ì‚¬ëƒ¥ì„ ê°€ìê³  í•©ë‹ˆë‹¤. í™”ì‚´ì´ ì–´ë””ë¡œ ë‚ ì•„ì˜¬ì§€ ëª¨ë¦…ë‹ˆë‹¤.â€", leftBtn: "ê²ë¨¹ì„ ìˆœ ì—†ë‹¤", rightBtn: "ì•„í”„ë‹¤ê³  í•œë‹¤", leftEffect: [5, -5, 0, 0, 0], rightEffect: [0, 0, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì²™ì¤€ê²½ì´ ìˆ ì— ì·¨í•´ ì™•ì‹¤ ê·¼ìœ„ë³‘ì„ í­í–‰í–ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì¥êµ°ì´ ì·¨í–ˆêµ¬ë ¤", rightBtn: "ê³¤ì¥ì„ ì³ë¼", leftEffect: [-5, 0, 5, 0, -5], rightEffect: [5, 0, -15, 0, 5] },
        { onlyPhase1: true, text: "â€œì„œì—­ ìƒì¸ì´ ì§ˆ ì¢‹ì€ ì² ê²€ì„ ê°€ì§€ê³  ì™”ìŠµë‹ˆë‹¤.â€", leftBtn: "ëª¨ë‘ ì‚¬ë“¤ì—¬ë¼", rightBtn: "ëˆì´ ì—†ë‹¤", leftEffect: [0, 0, 10, -15, 0], rightEffect: [0, 0, -5, 0, 0] },
        { onlyPhase1: true, text: "â€œì‹ ë´‰ë¬¸(ç¥é³³é–€)ì— í–‰ì°¨í•˜ì—¬ ì£„ì¸ë“¤ì„ ì‚¬ë©´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "ë•ì„ ë² í’€ë¼", rightBtn: "ë²•ì€ ì—„ê²©í•´ì•¼ í•œë‹¤", leftEffect: [5, 0, 0, 0, 10], rightEffect: [0, 0, 5, 0, -5] },
        { onlyPhase1: true, text: "â€œê¹€ë¶€ì‹ ë“±ì´ ì„ ì™•ì˜ ê¸°ë¡ì¸ 'ì˜ˆì¢…ì‹¤ë¡' í¸ì°¬ì„ ì‹œì‘í•˜ê² ë‹¤ê³  í•©ë‹ˆë‹¤.â€", leftBtn: "ì§€ì›ì„ ì•„ë¼ì§€ ë§ˆë¼", rightBtn: "êµ­ê³ ë¥¼ ì•„ê»´ë¼", leftEffect: [5, -5, 0, -10, 0], rightEffect: [0, 0, 0, 5, 0] },
        { onlyPhase1: true, text: "â€œíŒ”ê´€íšŒë¥¼ ì—´ì–´ ë¶€ì²˜ë‹˜ì˜ í˜ìœ¼ë¡œ ë‚˜ë¼ì˜ ì•ˆë…•ì„ ë¹Œ ì‹œê¸°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì„±ëŒ€í•˜ê²Œ ì—´ì–´ë¼", rightBtn: "ê°„ì†Œí•˜ê²Œ í•˜ë¼", leftEffect: [0, 0, 0, -15, 10], rightEffect: [0, 0, 0, 5, -5] },
        { onlyPhase1: true, text: "â€œë™ì—¬ì§„ ì¶”ì¥ì´ í™”ì¹œì˜ ì˜ë¯¸ë¡œ ì¢‹ì€ ë§ì„ ë°”ì³¤ìŠµë‹ˆë‹¤.â€", leftBtn: "í•˜ì‚¬í’ˆì„ ë‚´ë ¤ë¼", rightBtn: "ê²½ê³„í•´ì•¼ í•œë‹¤", leftEffect: [0, 0, 5, -5, 0], rightEffect: [0, 0, -5, 0, 0] },
        { onlyPhase1: true, text: "â€œì†¡ë‚˜ë¼ ì‚¬ì‹ ì´ ì „í•˜ê»˜ ì •ì‹ìœ¼ë¡œ ì±…ë´‰ì„ ìš”ì²­í•˜ë¼ê³  ê·€ë”í–ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì‚¬ì‹ ì„ ë³´ë‚´ë¼", rightBtn: "ìš°ë¦¬ëŠ” ë…ìì ì´ë‹¤", leftEffect: [10, 0, 0, -5, 0], rightEffect: [-5, 0, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ ëŒ€ê°ì´ ê³µì„ ì¸ì •ë°›ì•„ 'ì¡°ì„ êµ­ê³µ(æœé®®åœ‹å…¬)'ì˜ ì§€ìœ„ì— ì˜¤ë¥´ê¸¸ ì›í•©ë‹ˆë‹¤.â€", leftBtn: "í—ˆë½í•œë‹¤...", rightBtn: "ê·¸ê±´ ì™•ì˜ ì§€ìœ„ë‹¤!", leftEffect: [-15, 25, 0, 0, 0], rightEffect: [10, -20, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ ëŒ€ê°ì´ ìì‹ ì˜ ì§‘ìœ¼ë¡œ ì „í•˜ë¥¼ ì´ˆëŒ€í•´ ë°¤ëŠ¦ê²Œê¹Œì§€ ì”ì¹˜ë¥¼ ì—´ìê³  í•©ë‹ˆë‹¤.â€", leftBtn: "ì¥ì¸ì˜ ì²­ì´ë‹ˆ ê°€ì", rightBtn: "ì²´í†µì„ ì§€ì¼œì•¼ í•œë‹¤", leftEffect: [-5, 10, 0, 0, 0], rightEffect: [5, -5, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œê¸ˆë‚˜ë¼ê°€ ìš°ë¦¬ êµ­ì„œê°€ í‘œë¬¸(ì‹ í•˜ì˜ ê¸€) í˜•ì‹ì´ ì•„ë‹ˆë¼ë©° ë°›ì§€ ì•Šê³  ëŒë ¤ë³´ëƒˆìŠµë‹ˆë‹¤!â€", leftBtn: "êµ´ìš•ì ì´ì§€ë§Œ ê³ ì³ë¼", rightBtn: "ì˜¤ë‘ìº ì£¼ì œì—!", leftEffect: [-10, 0, 0, 0, 0], rightEffect: [5, 0, 10, -5, 0] },
        { onlyPhase1: true, text: "â€œì¡ë¥˜(ì²œí•œ ì¶œì‹ )ì˜ ìì†ë“¤ì´ ê´€ì§ì— ì˜¤ë¥´ëŠ” ê²ƒì„ ì œí•œí•´ì•¼ í•œë‹¤ëŠ” ìƒì†Œì…ë‹ˆë‹¤.â€", leftBtn: "ê¸°ê°•ì„ ë°”ë¡œì¡ì•„ë¼", rightBtn: "ëŠ¥ë ¥ì´ ì¤‘ìš”í•˜ë‹¤", leftEffect: [0, 5, 0, 0, -5], rightEffect: [0, -5, 0, 0, 5] },
        { onlyPhase1: true, text: "â€œìš”ë‚˜ë¼(ê±°ë€)ë¡œ ë³´ë‚¸ ì‚¬ì‹ ì´ ê¸¸ì´ ë§‰í˜€ ë„ì°©í•˜ì§€ ëª»í•˜ê³  ëŒì•„ì™”ìŠµë‹ˆë‹¤. êµ­ì œ ì •ì„¸ê°€ ì‹¬ìƒì¹˜ ì•ŠìŠµë‹ˆë‹¤.â€", leftBtn: "ê¸ˆë‚˜ë¼ì™€ ì¹œí•´ì§€ì", rightBtn: "ì†¡ë‚˜ë¼ë¥¼ ë¯¿ì", leftEffect: [0, 5, -5, 0, 0], rightEffect: [5, 0, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œê°€ë­„ì´ ê³„ì†ë˜ê³  ìˆìŠµë‹ˆë‹¤. ë¬´ë‹¹ì„ ëª¨ì•„ ë¹„ë¥¼ ë¹Œì–´ì•¼ í•œë‹¤ëŠ” ê±´ì˜ê°€ ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ê¸°ìš°ì œë¥¼ ì§€ë‚´ë¼", rightBtn: "ë¯¸ì‹ ì¼ ë¿ì´ë‹¤", leftEffect: [0, 0, 0, -5, 5], rightEffect: [0, 0, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œì–µìš¸í•¨ì„ í˜¸ì†Œí•˜ëŠ” ì£„ìˆ˜ë“¤ì´ ë§ìŠµë‹ˆë‹¤. ì¬ì‹¬ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "ë‹¤ì‹œ ì‚´í´ë¼", rightBtn: "íŒê²°ì€ ìœ ì§€ëœë‹¤", leftEffect: [5, 0, 0, 0, 5], rightEffect: [0, 0, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œì§€ë°©ì˜ ì£¼(å·)ì™€ ì§„(é­)ì„ ì§€í‚¤ëŠ” ì¥êµë“¤ì˜ ë…¹ë´‰(ì›”ê¸‰) ê¸°ì¤€ì„ ì •í•´ì•¼ í•©ë‹ˆë‹¤.â€", leftBtn: "í›„í•˜ê²Œ ì¤˜ë¼", rightBtn: "ì ë‹¹íˆ ì¤˜ë¼", leftEffect: [0, 0, 10, -10, 0], rightEffect: [0, 0, -5, 5, 0] },
        { onlyPhase1: true, text: "â€œíƒê´€ì˜¤ë¦¬ë“¤ì´ êµ­ë²•ì„ êµë¬˜í•˜ê²Œ ì•…ìš©í•´ ë°±ì„±ë“¤ì„ ìˆ˜íƒˆí•˜ê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì—„ë²Œì— ì²˜í•˜ë¼!", rightBtn: "ê´€ë£Œë“¤ì„ ë¯¿ì–´ë³´ì", leftEffect: [5, -5, 0, 0, 10], rightEffect: [-5, 5, 0, 0, -10] },
        { onlyPhase1: true, text: "â€œê³¼ê±° ì‹œí—˜ í•©ê²©ì ëª…ë‹¨ì´ ì˜¬ë¼ì™”ìŠµë‹ˆë‹¤. ëˆ„êµ¬ë¥¼ ë“±ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "ëŠ¥ë ¥ ìœ„ì£¼ë¡œ ë½‘ì•„ë¼", rightBtn: "ì¶”ì²œë°›ì€ ìë¥¼ ë½‘ì•„ë¼", leftEffect: [5, -5, 0, 0, 0], rightEffect: [-5, 10, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œëŒ€ë‚®ì— í•´ê°€ ë¹›ì„ ìƒì—ˆìŠµë‹ˆë‹¤(ì¼ì‹)! ì™•ì˜ ë¶€ë•í•¨ì„ ê²½ê³ í•˜ëŠ” í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤.â€", leftBtn: "ììˆ™í•˜ê³  ë°˜ì„±í•œë‹¤", rightBtn: "ìì—° í˜„ìƒì¼ ë¿ì´ë‹¤", leftEffect: [-5, 0, 0, 0, 5], rightEffect: [0, 0, 0, 0, -5] },
        { onlyPhase1: true, text: "â€œì •ê¸° ì¸ì‚¬ë¥¼ ë‹¨í–‰í•  ì‹œê¸°ì…ë‹ˆë‹¤. ì£¼ìš” ê´€ì§ì„ ì–´ë–»ê²Œ ì±„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "ë‚´ ì‚¬ëŒì„ ì‹¬ëŠ”ë‹¤", rightBtn: "ì™¸ì²™ì—ê²Œ ìë¬¸ì„ êµ¬í•œë‹¤", leftEffect: [10, -10, 0, 0, 0], rightEffect: [-10, 15, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œë©¸ë§í•´ê°€ëŠ” ê±°ë€(ìš”ë‚˜ë¼)ì—ì„œ ì‚¬ì‹ ì„ ë³´ë‚´ êµ¬ì›ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì‚¬ì‹ ì„ ë§ì´í•˜ë¼", rightBtn: "ê¸ˆë‚˜ë¼ ëˆˆì¹˜ê°€ ë³´ì¸ë‹¤", leftEffect: [0, 0, 5, -5, 0], rightEffect: [0, 0, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œí•˜ëŠ˜ì— ë¶‰ì€ ê¸°ìš´ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤! í‰í‰í•œ ì§•ì¡°ê°€ ì•„ë‹ˆê² ìŠµë‹ˆê¹Œ?â€", leftBtn: "ê²½ê³„ë¥¼ ê°•í™”í•˜ë¼", rightBtn: "ë¬´ì‹œí•´ë¼", leftEffect: [0, 0, 5, -5, -5], rightEffect: [0, 0, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì´ìê²¸ì´ ìì‹ ì„ 'ì‹ í•˜'ê°€ ì•„ë‹ˆë¼ 'ì¡°ë¶€(í• ì•„ë²„ì§€)'ë¼ê³ ë§Œ ë¶€ë¥´ê² ë‹¤ í•©ë‹ˆë‹¤.â€", leftBtn: "ê·¸ëŸ¬ì‹œì˜¤", rightBtn: "êµ°ì‹ ì˜ ì˜ˆë¥¼ ì§€í‚¤ì‹œì˜¤", leftEffect: [-10, 15, 0, 0, 0], rightEffect: [10, -15, 0, 0, 0] },
        { onlyPhase1: true, text: "â€œì²™ì¤€ê²½ì´ ì´ìê²¸ì—ê²Œ ì„œìš´í•¨ì„ ëŠë¼ê³  ìˆìŠµë‹ˆë‹¤. ëˆ„êµ¬ì—ê²Œ ì„ ë¬¼ì„ ë³´ë‚¼ê¹Œìš”?â€", leftBtn: "ì¥ì¸ì—ê²Œ ë°‰ë³´ì¼ ì´ìœ ëŠ” ì—†ë‹¤", rightBtn: "ìš©ë§¹í•œ ì¥êµ°ì„ ìœ„ë¡œí•œë‹¤", leftEffect: [0, 10, -5, -5, 0], rightEffect: [5, -5, 15, -5, 0] },
        { onlyPhase1: true, text: "â€œê°€ë­„ì´ ì‹¬ê°í•´ì ¸ì„œ ê°•ì˜ ë°”ë‹¥ì´ ë³´ì¼ ì •ë„ì…ë‹ˆë‹¤.â€", leftBtn: "ê¸°ìš°ì œë¥¼ ì˜¬ë¦¬ì", rightBtn: "ê°œì…í•˜ì§€ ì•ŠëŠ”ë‹¤", leftEffect: [0, 0, 0, -10, 10], rightEffect: [0, 0, 0, 0, -10] },
        { onlyPhase1: true, text: "â€œê¶ê¶ ì •ì›ì—ì„œ ìŒë‘¥ì´ ë´‰í™©ìƒˆê°€ ë‚˜íƒ€ë‚¬ë‹¤ëŠ” ì†Œë¬¸ì´ ëŒê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ê¸¸ì¡°ë¥¼ ë„ë¦¬ í¼íŠ¸ë ¤ë¼", rightBtn: "ì´ëŠ” ì™•ì‹¤ì˜ ë³µì´ë‹¤", leftEffect: [5, 0, 0, 0, 10], rightEffect: [10, 0, 0, 0, 5] },
        { onlyPhase1: true, text: "â€œêµ°ëŒ€ì˜ ë¹„ì¶• êµ°ëŸ‰ë¯¸ê°€ ì©ì–´ì„œ ëª» ì“°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.â€", leftBtn: "ì•Œë§¹ì´ì™€ ì­‰ì •ì´ëŠ” ë¶„ë¦¬í•´ì•¼ì§€", rightBtn: "ë‹¤ì‹œ ì±„ì›Œë„£ì–´ë¼", leftEffect: [0, 0, 5, 0, 0], rightEffect: [0, 0, 10, -15, 0] },
        { onlyPhase1: true, text: "â€œê¸ˆë‚˜ë¼ ì‚¬ì‹ ì´ ê³ ë ¤ì— ë¨¸ë¬´ëŠ” ë™ì•ˆ íš¡í¬ë¥¼ ë¶€ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.â€", leftBtn: "ê°ë‚´í•´ë¼", rightBtn: "ì„œì‹ ìœ¼ë¡œ ë¶ˆì¾Œê°ì„ í‘œí˜„í•´ë¼", leftEffect: [-5, 0, 0, 0, -5], rightEffect: [5, 0, 5, 0, 5] },
        { onlyPhase1: true, text: "â€œì²™ì¤€ê²½ì´ ê¶ê¶ì—ì„œ ë‚˜ë¬´ë¥¼ ë“¤ì–´ì˜¬ë ¤ íœ˜ë‘ë¥´ëŠ” ê¸°ì˜ˆë¥¼ ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.â€", leftBtn: "ê·¸ëŒ€ëŠ” ê³ ë ¤ì˜ ë³´ë°°ë‹¤!", rightBtn: "ì¬ë¯¸ìˆëŠ” ë¬˜ê¸°ë¡œêµ°!", leftEffect: [0, -5, 15, 0, 0], rightEffect: [5, 0, 5, 0, 0] },
        { onlyPhase1: true, text: "â€œì²™ì¤€ê²½ì˜ ë¨¼ ì¹œì²™ì´ ì¬íŒì— íœ˜ë§ë ¤, ì€ë°€íˆ í¸ì˜ë¥¼ ë´ë‹¬ë¼ ì²­íƒí•©ë‹ˆë‹¤.â€", leftBtn: "ì²´ë©´ì„ ì„¸ì›Œì¤€ë‹¤", rightBtn: "ì¬íŒì€ ê³µì •í•´ì•¼í•œë‹¤", leftEffect: [0, 0, 10, 0, -10], rightEffect: [5, 0, -10, 0, 10] },

        // [2í˜ì´ì¦ˆ]
        { requirePhase2: true, text: "ê±°ì‚¬ë¥¼ ì£¼ë„í•œ ìµœíƒ, ì•ˆë³´ë¦° ë“±ì´ ì²´í¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìê²¸ì´ ì²˜ë²Œì„ ìš”êµ¬í•©ë‹ˆë‹¤.", leftBtn: "ëª¨ë‘ ë‚´ê°€ ì‹œí‚¨ ì¼ì´ë‹¤", rightBtn: "ë‚˜ëŠ” ëª¨ë¥´ëŠ” ì¼ì´ë‹¤", leftEffect: [15, -20, 0, 0, 10], rightEffect: [-20, 10, 0, 0, -10] },
        { requirePhase2: true, text: "ì´ìê²¸ì´ ì˜¥ìƒˆë¥¼ ë‚´ë†“ìœ¼ë¼ê³  í˜‘ë°•í•©ë‹ˆë‹¤. ë¶“ê³¼ ì¢…ì´ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.", leftBtn: "ë„¤ ì´ë†ˆ!", rightBtn: "ì•Œê² ë‹¤...", leftEffect: [10, -15, 0, 0, 0], rightEffect: [-20, 15, 0, 0, 0] },
        { requirePhase2: true, text: "ì´ìê²¸ì´ ì „í•˜ì˜ ê±°ì²˜ë¥¼ ìì‹ ì˜ ì§‘ìœ¼ë¡œ ì˜®ê¸°ê³ ì í•©ë‹ˆë‹¤.", leftBtn: "ë‚´ ê¶ê¶ì€ ì´ê³³ì´ë‹¤!", rightBtn: "ì˜ ë¶€íƒí•©ë‹ˆë‹¤, ì¥ì¸ì–´ë¥¸", leftEffect: [5, -10, 0, 0, 0], rightEffect: [-15, 10, 0, 0, 0] },
	{ requirePhase2: true, text: "ì´ìê²¸ ëŒ€ê°ì´ ì „í•˜ê»˜ ë–¡ì„ ë³´ëƒˆìŠµë‹ˆë‹¤. ë¬´ì–¸ê°€ ìˆ˜ìƒí•©ë‹ˆë‹¤.", leftBtn: "ì¥ì¸ì˜ ì •ì„±ì¸ë°...", rightBtn: "ìƒˆì—ê²Œ ë˜ì ¸ë¼", leftEffect: [0, 0, 0, 0, 0], isPoison: true, rightEffect: [5, -10, 0, 0, 0] }
    ];

    window.onload = function() { 
        showIntroText(); // ë¡œë”© ì‹œ ì²« í…ìŠ¤íŠ¸ í‘œì‹œ
        renderStats(); 
        pickNewCard(); 
    };

    function resetGame() {
        stats = { royal: 50, kin: 50, military: 50, money: 50, public: 50 };
        turn = 1; isPhase2 = false; phase2StartTurn = 0;
        
        randomDeck.forEach(c => c.hasPlayed = false);

        document.body.classList.remove("phase-fire");
        document.getElementById("game-over-screen").style.display="none";
        document.getElementById("intro-screen").style.display="none"; // ë°”ë¡œ ê²Œì„ ì‹œì‘
        document.getElementById("game-container").style.opacity=1;
        document.querySelector(".history-paper").classList.remove("open-effect");

        renderStats(); pickNewCard(); initSwipe();
    }

    function pickNewCard() {
        if (isPhase2) document.body.classList.add("phase-fire");
        else document.body.classList.remove("phase-fire");

        if (nextEventCard) {
            currentCard = nextEventCard;
            nextEventCard = null;
        } else {
            const sCard = storyDeck.find(c => c.id === turn);
            if (sCard) {
                if (sCard.id === 51 && isPhase2) {
                    pickRandomCard();
                } else {
                    currentCard = sCard;
                }
            } else {
                pickRandomCard();
            }
        }

        const overlay = document.getElementById("warning-overlay");
        const container = document.getElementById("game-container");

        if (currentCard.id === 45) {
            overlay.classList.add("hint");
            overlay.style.display = "block";
            container.classList.remove("shake-effect"); 
        } 
        else if (currentCard.id === 46 || currentCard.id === 51) {
            overlay.classList.remove("hint");
            overlay.style.display = "block";
            container.classList.add("shake-effect");
        } 
        else {
            overlay.classList.remove("hint");
            overlay.style.display = "none";
            container.classList.remove("shake-effect");
        }

        updateUI();
    }

    function pickRandomCard() {
        const validCards = randomDeck.filter(card => {
            const min = card.minTurn || 1;
            const max = card.maxTurn || 9999;
            const turnMatch = turn >= min && turn <= max;
            
            let phaseMatch = true;
            if (card.requirePhase2 && !isPhase2) phaseMatch = false; 
            if (card.onlyPhase1 && isPhase2) phaseMatch = false;

            if (card.hasPlayed) return false;

            return turnMatch && phaseMatch;
        });

        if (validCards.length > 0) {
            currentCard = validCards[Math.floor(Math.random() * validCards.length)];
            currentCard.hasPlayed = true;
        } else {
            currentCard = { text: "í‰ì˜¨í•œ í•œ ë‹¬ì´ ì§€ë‚˜ê°‘ë‹ˆë‹¤.", leftBtn: "êµ­ì • ì‚´í”¼ê¸°", rightBtn: "íœ´ì‹", leftEffect:[0,0,0,0,0], rightEffect:[0,0,0,0,0] };
        }
    }

    function updateUI() {
        document.getElementById("question-text").innerHTML = currentCard.text;

	if (isPhase2) {
            document.getElementById("label-royal").innerText = "ì¸ì¢…";
            document.getElementById("label-kin").innerText = "ì´ìê²¸";
            document.getElementById("label-military").innerText = "ì²™ì¤€ê²½";
        } else {
            // 1í˜ì´ì¦ˆê±°ë‚˜ ë¦¬ì…‹ë˜ì—ˆì„ ë•Œ ì›ìƒë³µêµ¬
            document.getElementById("label-royal").innerText = "ì™•ê¶Œ";
            document.getElementById("label-kin").innerText = "ì™¸ì²™";
            document.getElementById("label-military").innerText = "êµ°ì‚¬";
        }

        let dateString = "";
        
        if (!isPhase2) {
            let y = Math.floor((turn-1)/12)+1; 
            let m = (turn-1)%12+1;
            dateString = `(ì¸ì¢… ${y}ë…„ ${m}ì›”)`;
        } else {
            let weeksPassed = (turn - phase2StartTurn) + 1;
            let startTotalMonths = phase2StartTurn - 1; 
            let addedMonths = Math.floor((turn - phase2StartTurn) / 4); 
            
            let currentTotalMonths = startTotalMonths + addedMonths;
            
            let y = Math.floor(currentTotalMonths / 12) + 1;
            let m = (currentTotalMonths % 12) + 1;
            dateString = `(ì¸ì¢… ${y}ë…„ ${m}ì›” - ê±°ì‚¬ ${weeksPassed}ì£¼ì°¨)`;
        }

        document.getElementById("year-text").innerText = dateString;
        
        const c = document.getElementById("game-card"); c.style.transform = "translate(0,0) rotate(0)";
        document.getElementById("choice-overlay").style.opacity=0; hidePreview();
    }

    function renderStats() {
        const topVals = [stats.royal, stats.kin, stats.military];
        const topIds = ["fill-royal", "fill-kin", "fill-military"];
        for(let i=0; i<3; i++) {
            const h = Math.max(0, Math.min(100, topVals[i]));
            const el = document.getElementById(topIds[i]);
            el.style.height = h + "%";
            if(h <= 20) el.style.backgroundColor = "#e74c3c";
            else if(h >= 100) el.style.backgroundColor = "#f1c40f"; 
            else el.style.backgroundColor = "#ecf0f1";
        }
        const botVals = [stats.money, stats.public];
        const botFillIds = ["fill-money", "fill-public"];
        const botTextIds = ["text-money", "text-public"];
        for(let i=0; i<2; i++) {
            const v = Math.max(0, Math.min(100, botVals[i]));
            document.getElementById(botFillIds[i]).style.width = v + "%";
            document.getElementById(botTextIds[i]).innerText = v;
            const fillEl = document.getElementById(botFillIds[i]);
            if(v <= 20) fillEl.style.backgroundColor = "#e74c3c";
            else fillEl.style.backgroundColor = "#f1c40f";
        }
    }

    function showPreview(ch) {
        let eff = (ch===0)?currentCard.leftEffect : (ch===1)?currentCard.rightEffect : (currentCard.downEffect||[0,0,0,0,0]);
        for(let i=0; i<5; i++) {
            if(eff[i] !== 0) document.getElementById(`ind-${i}`).classList.add("active");
            else document.getElementById(`ind-${i}`).classList.remove("active");
        }
    }
    function hidePreview() { for(let i=0; i<5; i++) document.getElementById(`ind-${i}`).classList.remove("active"); }

    function makeChoice(ch) {
        document.getElementById("warning-overlay").style.display = "none";
        document.getElementById("game-container").classList.remove("shake-effect");

        if (currentCard.isPoison && ch === 0) {
            unlockAchievement("die_poison");
            checkGameOver(true, "ë…ì‚´", "ë–¡ì— ë“  ë§¹ë…ì´ í¼ì ¸ ì†ì“¸ ìƒˆë„ ì—†ì´ ìŠ¹í•˜í•˜ì…¨ìŠµë‹ˆë‹¤.");
            return;
        }

        if ((currentCard.id === 46 && ch === 0) || currentCard.id === 51) {
            if (!isPhase2) {
                isPhase2 = true;
                phase2StartTurn = turn; 
            }
        }

        let eff = (ch===0)?currentCard.leftEffect : (ch===1)?currentCard.rightEffect : (currentCard.downEffect||[0,0,0,0,0]);
        stats.royal += eff[0]||0; stats.kin += eff[1]||0; stats.military += eff[2]||0;
        stats.money += eff[3]||0; stats.public += eff[4]||0;
	if (stats.money >= 100) unlockAchievement("max_money");
        if (stats.public >= 100) unlockAchievement("max_public");
        
        let hasNextEvent = false;

        if (ch === 0 && currentCard.leftNext) {
            nextEventCard = currentCard.leftNext;
            hasNextEvent = true;
        } else if (ch === 1 && currentCard.rightNext) {
            nextEventCard = currentCard.rightNext;
            hasNextEvent = true;
        } else if (ch === 2 && currentCard.downNext) {
            nextEventCard = currentCard.downNext;
            hasNextEvent = true;
        }

        if (turn === 50) unlockAchievement("turn_50");
        if (turn === 100) unlockAchievement("turn_100");

        renderStats(); 

        if(!checkGameOver()) { 
            if (!hasNextEvent) {
                turn++; 
            }
            pickNewCard(); 
        }
    }

    function checkGameOver(force=false, fTitle="", fMsg="") {
        let t="íŒ¨ë°°", m="", over=false;
        
        if (force) { t=fTitle; m=fMsg; over=true; }
        else if(stats.royal<=0){ t="íìœ„"; m="ì™•ìœ„ì˜ ê¸°ë‘¥ì´ ë¬´ë„ˆì§€ê³ , ê²°êµ­ ì‹ í•˜ë“¤ì— ì˜í•´ íìœ„ë˜ì—ˆìŠµë‹ˆë‹¤."; unlockAchievement("die_royal"); over=true; }
        else if(stats.kin<=0){ t="ë…ì‚´"; m="ì§€ë‚˜ì¹œ ê²¬ì œì— ìœ„ê¸°ê°ì„ ëŠë‚€ ì™¸ì²™ì—ê²Œ ë…ì‚´ë‹¹í–ˆìŠµë‹ˆë‹¤."; unlockAchievement("die_poison"); over=true; }
        else if(stats.kin>=100){ t="ê¼­ë‘ê°ì‹œ"; m="ì™¸ì²™ì˜ ì†ì•„ê·€ì— ì¡°ì •ì´ ë„˜ì–´ê°€ê³ , í—ˆìˆ˜ì•„ë¹„ ì„ê¸ˆì´ ë˜ì—ˆìŠµë‹ˆë‹¤."; unlockAchievement("die_kin"); over=true; }
        else if(stats.military<=0){ t="í•¨ë½"; m="êµ°ì„¸ê°€ í©ì–´ì§€ì ë¶ë°©ì´ ë¬´ë„ˆì§€ê³ , ê³ ë ¤ê°€ ì˜¤ë‘ìºì˜ ë°œ ì•„ë˜ì— ì§“ë°Ÿí™ë‹ˆë‹¤."; unlockAchievement("die_military"); over=true; }
        else if(stats.military>=100){ t="ì •ë³€"; m="ë¹„ëŒ€í•´ì§„ êµ°ë¶€ê°€ ì™•ì„ ëª°ì•„ë‚´ê³  ë¬´ì‹ ì •ê¶Œì„ ìˆ˜ë¦½í–ˆìŠµë‹ˆë‹¤."; unlockAchievement("die_military"); over=true; }
        else if(stats.money<=0){ t="íŒŒì‚°"; m="ì¬ì •ì´ ë°”ë‹¥ë‚˜ ë°±ì„±ë“¤ì˜ ì‹œë¦„ë§Œ ë”ìš± ê¹Šì–´ì§ˆ ë¿ì…ë‹ˆë‹¤."; unlockAchievement("die_money"); over=true; }
        else if(stats.public<=0){ t="ë¯¼ë€"; m="ì„±ë‚œ ë°±ì„±ë“¤ì´ ê¶ìœ¼ë¡œ ì³ë“¤ì–´ì™”ìŠµë‹ˆë‹¤."; unlockAchievement("die_public"); over=true; }
        else if(stats.military>=80 && stats.royal>=70 && stats.kin<=30){ t="êµ°ì£¼"; m="ì´ìê²¸ì„ ëª°ì•„ë‚´ê³  ê³ ë ¤ì˜ ì£¼ê¶Œì„ ë˜ì°¾ì•˜ìŠµë‹ˆë‹¤!"; document.getElementById("end-title").style.color="#f1c40f"; unlockAchievement("win_balance"); over=true; }

        if(over) {
            generateHistory(t, m);
            const screen = document.getElementById("game-over-screen");
            document.getElementById("game-container").style.opacity = 0; 
            screen.style.display = "flex";
            
            setTimeout(() => {
                document.querySelector(".history-paper").classList.add("open-effect");
            }, 50);
            return true;
        }
        return false;
    }

    function generateHistory(title, reason) {
        const content = document.getElementById("history-content");
        
        let years = Math.floor((turn-1)/12)+1;
        let months = (turn-1)%12+1;
        let reignTime = `ì¸ì¢… ${years}ë…„ ${months}ì›”`;

        let records = [];
        if (turn > 12) records.push(`ì¦‰ìœ„ ì´ˆ, ì´ìê²¸ì˜ ìœ„ì„¸ ì†ì—ì„œë„ ${years}ë…„ ë„˜ê²Œ ë²„í‹°ì—ˆë‹¤.`);
        if (isPhase2) records.push("ì´ìê²¸ì˜ ì „íš¡ì— ë§ì„œ ê±°ì‚¬ë¥¼ ë„ëª¨í•˜ì˜€ë‹¤.");
        if (phase2StartTurn > 0 && turn - phase2StartTurn > 4) records.push("ê±°ì‚¬ ì‹¤íŒ¨ í›„ì—ë„ ëˆì§ˆê¸°ê²Œ ì €í•­í•˜ë©° ê¸°íšŒë¥¼ ì—¿ë³´ì•˜ë‹¤.");
        
        if (stats.money > 80) records.push("êµ­ê³ ë¥¼ ê°€ë“ ì±„ì›Œ ë‚˜ë¼ì˜ ì‚´ë¦¼ì„ ìœ¤íƒí•˜ê²Œ í–ˆë‹¤.");
        if (stats.public > 80) records.push("ë°±ì„±ë“¤ì˜ ëª©ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì—¬ ì„±êµ°ì˜ ìì§ˆì„ ë³´ì˜€ë‹¤.");
        if (stats.military > 80) records.push("êµ°ì‚¬ë ¥ì„ ê°•í•˜ê²Œ í‚¤ì›Œ ë¶ë°©ì„ ê²½ê³„í–ˆë‹¤.");
        
        let evaluation = "";
        switch(title) {
            case "êµ°ì£¼": evaluation = "ì™•ì€ ì§€í˜œë¡­ê³  ìš©ë§¹í•˜ì—¬ ì™¸ì²™ì˜ ë°œí˜¸ë¥¼ ëˆ„ë¥´ê³  ì™•ì‹¤ì˜ ìœ„ì—„ì„ ë˜ì°¾ì•˜ë‹¤. "; break;
            case "ë…ì‚´": case "íìœ„": evaluation = "ì™•ì€ ëœ»ì„ í´ë³´ë ¤ í–ˆìœ¼ë‚˜, ì‹œëŒ€ì˜ íë¦„ê³¼ ì™¸ì²™ì˜ íš¡í¬ë¥¼ ì´ê²¨ë‚´ì§€ ëª»í–ˆë‹¤."; break;
            case "í—ˆìˆ˜ì•„ë¹„": evaluation = "ì™•ì¢Œì— ìˆì—ˆìœ¼ë‚˜ ì™•ì€ ì•„ë‹ˆì—ˆë‹¤. ê¶Œë ¥ì€ ì‹ í•˜ì—ê²Œ ìˆì—ˆìœ¼ë‹ˆ, ì´ë¥¼ ì–´ì°Œ ì™•ì´ë¼ í•˜ê² ëŠ”ê°€."; break;
            case "ì •ë³€": case "í•¨ë½": evaluation = "ë¬´ë ¥ì„ í†µì œí•˜ì§€ ëª»í•´ ìŠ¤ìŠ¤ë¡œ í™”ë¥¼ ë¶ˆë €ë‹¤. ì¹¼ë¡œ í¥í•œ ì, ì¹¼ë¡œ ë§í•˜ëŠ” ë²•."; break;
            case "íŒŒì‚°": case "ë¯¼ë€": evaluation = "ë°±ì„±ì˜ ì‚¶ì„ ëŒë³´ì§€ ì•Šê³  ê·¼ë³¸ì„ ìƒì—ˆìœ¼ë‹ˆ, ì²œëª…(å¤©å‘½)ì´ ë– ë‚œ ê²ƒì€ ë‹¹ì—°í•œ ì´ì¹˜."; break;
            default: evaluation = "ì™•ì˜ ì¹˜ì„¸ëŠ” ì§§ê³  ë§ì—†ì—ˆë‹¤. ì—­ì‚¬ëŠ” ê·¸ë¥¼ ë¹„ìš´ì˜ êµ°ì£¼ë¡œ ê¸°ì–µí•  ê²ƒì´ë‹¤.";
        }

        let html = `
            <div class="history-section">
                <span class="history-label">â–£ ì¬ìœ„:</span>
                <span class="history-text">${reignTime}ì— ë¶•ì–´(å´©å¾¡)í•˜ë‹¤.</span>
            </div>
            <div class="history-section">
                <span class="history-label">â–£ ì‚¬ì¸:</span>
                <span class="history-text">${reason}</span>
            </div>
            <div class="history-section">
                <span class="history-label">â–£ ì¹˜ì„¸ì˜ ê¸°ë¡:</span>
                <ul class="history-list">
                    ${records.length > 0 ? records.map(r => `<li>${r}</li>`).join('') : "<li>íŠ¹ë³„íˆ ê¸°ë¡í•  ë§Œí•œ ì¼ì´ ì—†ë‹¤.</li>"}
                </ul>
            </div>
            <div class="history-section" style="border-top:1px dashed #ccc; padding-top:10px; margin-top:20px;">
                <span class="history-label">â–£ ì‚¬ê´€ì˜ í‰:</span><br>
                <span class="history-text" style="font-style: italic;">"${evaluation}"</span>
            </div>
        `;
        content.innerHTML = html;
    }

    function initSwipe() {
        const card=document.getElementById("game-card"), ov=document.getElementById("choice-overlay");
        if(card.getAttribute("d-s")==="1")return; card.setAttribute("d-s","1");
        let sX=0, sY=0, isD=false; let cX=0, cY=0; 
        const start=(x,y)=>{ sX=x; sY=y; isD=true; card.style.transition="none"; };
        const move=(x,y)=>{
            if(!isD)return;
            cX=x-sX; cY=y-sY;
            if(Math.abs(cY)>Math.abs(cX) && cY>0) { 
                card.style.transform=`translate(0,${cY}px)`;
                ov.style.opacity=Math.min(cY/100,1); ov.innerText=currentCard.downBtn||"...(ì¹¨ë¬µí•œë‹¤)"; ov.style.color="#95a5a6";
                showPreview(2);
            } else { 
                card.style.transform=`translate(${cX}px,${cY*0.2}px) rotate(${cX*0.05}deg)`;
                ov.style.opacity=Math.min(Math.abs(cX)/100,1);
                if(cX<0){ ov.innerText=currentCard.leftBtn; ov.style.color="#e74c3c"; showPreview(0); }
                else{ ov.innerText=currentCard.rightBtn; ov.style.color="#27ae60"; showPreview(1); }
            }
        };
        const end=()=>{
            if(!isD)return; isD=false; card.style.transition="transform 0.3s";
            if(cY>100 && Math.abs(cY)>Math.abs(cX)){ card.style.transform=`translate(0,1000px)`; setTimeout(()=>makeChoice(2),200); }
            else if(cX>100){ card.style.transform=`translate(1000px,0) rotate(30deg)`; setTimeout(()=>makeChoice(1),200); }
            else if(cX<-100){ card.style.transform=`translate(-1000px,0) rotate(-30deg)`; setTimeout(()=>makeChoice(0),200); }
            else { card.style.transform="translate(0,0) rotate(0)"; ov.style.opacity=0; hidePreview(); }
            cX=0; cY=0;
        };
        card.addEventListener("touchstart",e=>start(e.touches[0].clientX,e.touches[0].clientY),{passive:false});
        card.addEventListener("mousedown",e=>start(e.clientX,e.clientY));
        window.addEventListener("touchmove",e=>{if(isD){e.preventDefault();move(e.touches[0].clientX,e.touches[0].clientY);}},{passive:false});
        window.addEventListener("mousemove",e=>move(e.clientX,e.clientY));
        window.addEventListener("touchend",end); window.addEventListener("mouseup",end);
    }
    </script>
</body>
</html>

